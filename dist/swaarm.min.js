window._Swaarm={_generateUUID:function(){for(var e={},t=[],i=0;i<256;i++)t[i]=(i<16?"0":"")+i.toString(16);return e.generate=function(){var e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,a=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&a]+t[a>>8&255]+t[a>>16&255]+t[a>>24&255]},e.generate()},getQueryParams:function(e){e=e.split("+").join(" ");for(var t,i={},n=/[?&]?([^=]+)=([^&]*)/g;t=n.exec(e);)i[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return i},SWAARM_CLICK_ID_NAME:"swaarm_clkid",SWAARM_USER_ID_NAME:"swaarm_userid",DEBUG:!1,log:function(e){this.DEBUG&&console.log("[SWWARM#SDK] "+e)},emitEvent:function(e,t){var i=this.trackingUrl+"postback?click_id="+e;for(var n in null==t&&(t={}),t)Object.prototype.hasOwnProperty.call(t,n)&&null!=t[n]&&(i+="&"+n+"="+t[n]);this.sendRequest(i)},sendRequest:function(e,t,i){this.log("Requesting "+e);var n=new XMLHttpRequest,a=this;n.addEventListener("load",(function(){a.log("Request to "+e+" sent successfully.")})),n.onreadystatechange=function(e){if(4===n.readyState&&200===n.status){var a=n.responseText;!0===i&&(a=JSON.parse(n.responseText)),null!=t&&t(a)}},n.open("GET",e),n.send()},sendSDKRequest:function(e){var t=this.trackingUrl+"websdk";this.log("Requesting SDK event: "+t);var i=new XMLHttpRequest,n=this;i.addEventListener("load",(function(){n.log("Request to "+t+" sent successfully.")})),null==e.vendorId&&(e.vendorId=this.userId),i.open("POST",t),i.setRequestHeader("Authorization","Bearer "+this.webToken),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(e))},validateInit:function(){if(!this.configured)throw new Error("You need to configure the Swaarm by calling Swaarm.initialize before using it.")},initialize:function(e,t,i,n){if(null==e||!e.startsWith("http"))throw new Error("Invalid tracking url received: "+e);"/"!==e.slice(-1)&&(e+="/"),this.trackingUrl=e,this.webToken=t,this.defaultOfferId=i,this.defaultPubId=n,this.configured=!0},enableDebug:function(){this.DEBUG=!0},_collectUtmData:function(){var e=this.getQueryParams(window.location.search),t=[];return e.utm_campaign&&t.push("campaign="+e.utm_campaign),e.utm_adset&&t.push("adset="+e.utm_adset),e.utm_ad&&t.push("ad="+e.utm_ad),e.utm_source&&t.push("site="+e.utm_source),e.utm_term&&t.push("term="+e.utm_term),e.swcid&&t.push("campaign_id="+e.swcid),e.swasid&&t.push("adset_id="+e.swasid),e.swaid&&t.push("ad_id="+e.swasid),e.swc&&t.push("campaign_id="+e.swc),e.swas&&t.push("adset_id="+e.swas),e.swa&&t.push("ad_id="+e.swa),e.gclid&&t.push("pub_click_id="+e.gclid),e.fbclid&&t.push("pub_click_id="+e.fbclid),e.ttclid&&t.push("pub_click_id="+e.ttclid),t.join("&")},_landOrganic:function(){var e=this.trackingUrl+"click?no_redirect=true&web_token="+this.webToken+"&"+this._collectUtmData();this.log("Organic user.");var t=this;this.sendRequest(e,(function(e){t._saveClickId(e.id)}),!0)},_saveClickId:function(e){this.log("Saving clkid "+e+"."),window.localStorage.setItem(this.SWAARM_CLICK_ID_NAME,e)},_saveUserId:function(e){this.log("Saving user id "+e+"."),window.localStorage.setItem(this.SWAARM_USER_ID_NAME,e)},land:function(){this.validateInit();var e=this.getQueryParams(window.location.search);null==e.clkid?(this.log("No clkid found."),null==this.webToken?this._sanLand():this._landOrganic()):this._saveClickId(e.clkid)},_sanLand:function(){this.validateInit();var e=this.getQueryParams(window.location.search);null==e.gclid&&null==e.fbclid&&this.log("No google or facebook click ids found");var t=this;this.sendRequest(this.trackingUrl+"click?no_redirect=true&offer_id="+this.defaultOfferId+"&pub_id="+this.defaultPubId+"&"+this._collectUtmData(),(function(e){t._saveClickId(e.id)}),!0)},click:function(e,t){this.validateInit(),this._baseClickImpression("click",e,t)},impression:function(e,t){this.validateInit(),this._baseClickImpression("impression",e,t)},_baseClickImpression:function(e,t,i){this.validateInit();var n=this.getQueryParams(window.location.search);for(var a in t)n[a]=t[a];var r=[];for(var s in n)r.push(s+"="+n[s]);var o=r.join("&");this.sendRequest(this.trackingUrl+e+o,i,!1)},adDetails:function(e,t,i){this.validateInit();var n=window.location.search;null!=e&&null!=t&&(n="offer_id="+e+"&pub_id"+t),this.sendRequest(this.trackingUrl+"ad"+n,i,!0)},replaceMarkedLinks:function(e,t,i){var n=null==e?"a":e,a=this;this.adDetails(null,null,(function(e){var r=e.advertiserTrackingUrl,s=e.clickTrackingUrl+"&no_redirect=true",o=e.impressionTrackingUrl+"&no_redirect=true";null==t?a.sendRequest(o):a.sendRequest(a.trackingUrl+"click?offer_id="+t+"&pub_id="+i+"&no_redirect=true"),document.querySelectorAll(n).forEach((e=>{e.href=r,e.addEventListener("click",(function(){a.sendRequest(s,(function(){document.location.href=r}))}))}))}))},getClickId:function(){return window.localStorage.getItem(this.SWAARM_CLICK_ID_NAME)},_getUserId:function(){var e=window.localStorage.getItem(this.SWAARM_USER_ID_NAME);return null!=e?e:window.localStorage.getItem(this.SWAARM_USER_ID_NAME)},attribute:function(){this.event(null)},event:function(e){this.validateInit();var t=this.getClickId();if(null==t){e=null==e?{}:e,this.log("No clickid found. Organic attribution.");var i=this._getUserId();if(null==i)return;return e.userId=i,void this._sdkEvent(e)}this.emitEvent(t,e)},_sdkEvent:function(e){this.sendSDKRequest({typeId:e.type,aggregatedValue:e.aggregated_value,customValue:e.event_value,vendorId:e.userId,revenue:e.sale_amount,currency:e.sale_amount_currency})}},window.Swaarm={initialize:function(e){window._Swaarm.initialize(e.trackingUrl,e.webToken,e.defaultOfferId,e.defaultPubId),e.debug&&window._Swaarm.enableDebug()},replaceMarkedLinks:function(e,t,i){window._Swaarm.replaceMarkedLinks(e,t,i)},land:function(){window._Swaarm.land()},click:function(e,t){window._Swaarm.click(e,t)},impression:function(e,t){window._Swaarm.click(e,t)},identifier:function(){return window._Swaarm._getUserId()},clickId:function(){return window._Swaarm.getClickId()},attribute:function(){window._Swaarm.attribute()},event:function(e,t){t=null==t?{}:t,window._Swaarm.event({event_id:e,sale_amount:t.saleAmount,sale_amount_currency:t.saleAmountCurrency,original_sale_amount:t.originalSaleAmount,original_sale_amount_currency:t.originalSaleAmountCurrency,aggregated_value:t.aggregatedValue,event_value:t.customValue})},setUserId:function(e){window._Swaarm._saveUserId(e)},open:function(){this.event("__open")}};