window._Swaarm={_generateUUID:function(){for(var i={},t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return i.generate=function(){var i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,a=4294967295*Math.random()|0;return t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]+"-"+t[255&e]+t[e>>8&255]+"-"+t[e>>16&15|64]+t[e>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&a]+t[a>>8&255]+t[a>>16&255]+t[a>>24&255]},i},getQueryParams:function(i){i=i.split("+").join(" ");for(var t,e={},n=/[?&]?([^=]+)=([^&]*)/g;t=n.exec(i);)e[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return e},setCookie:function(i,t,e){var n="";if(e){var a=new Date;a.setTime(a.getTime()+60*e*60*1e3),n="; expires="+a.toUTCString()}document.cookie=i+"="+(t||"")+n+"; path=/"},getCookie:function(i){for(var t=i+"=",e=document.cookie.split(";"),n=0;n<e.length;n++){for(var a=e[n];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null},SWAARM_CLICK_ID_NAME:"swaarm_clkid",SWAARM_USER_ID_NAME:"swaarm_userid",DEBUG:!1,log:function(i){this.DEBUG&&console.log("[SWWARM#SDK] "+i)},emitEvent:function(i,t){var e=this.trackingUrl+"postback?click_id="+i;for(var n in null==t&&(t={}),t)Object.prototype.hasOwnProperty.call(t,n)&&null!=t[n]&&(e+="&"+n+"="+t[n]);this.sendRequest(e)},sendRequest:function(i,t,e){this.log("Requesting "+i);var n=new XMLHttpRequest,a=this;n.addEventListener("load",(function(){a.log("Request to "+i+" sent successfully.")})),n.onreadystatechange=function(i){if(4===n.readyState&&200===n.status){var a=n.responseText;!0===e&&(a=JSON.parse(n.responseText)),null!=t&&t(a)}},n.open("GET",i),n.send()},validateInit:function(){if(!this.configured)throw new Error("You need to configure the Swaarm by calling Swaarm.initialize before using it.")},initialize:function(i,t){if(null==i||!i.startsWith("http"))throw new Error("Invalid tracking url received: "+i);"/"!==i.slice(-1)&&(i+="/"),this.trackingUrl=i,this.configured=!0,this.webToken=t},enableDebug:function(){this.DEBUG=!0},_collectUtmData:function(){var i=this.getQueryParams(window.location.search),t=[];return i.utm_campaign&&t.push("campaign="+i.utm_campaign),i.utm_adset&&t.push("adset="+i.utm_adset),i.utm_ad&&t.push("ad="+i.utm_ad),i.utm_source&&t.push("site="+i.utm_source),i.utm_term&&t.push("term="+i.utm_term),i.swcid&&t.push("campaign_id="+i.swcid),i.swasid&&t.push("adset_id="+i.swasid),i.swaid&&t.push("ad_id="+i.swasid),i.swc&&t.push("campaign_id="+i.swc),i.swas&&t.push("adset_id="+i.swas),i.swa&&t.push("ad_id="+i.swa),i.gclid&&t.push("pub_click_id="+i.gclid),i.fbclid&&t.push("pub_click_id="+i.fbclid),i.ttclid&&t.push("pub_click_id="+i.ttclid),t.join("&")},_landOrganic:function(){var i=this.trackingUrl+"click?no_redirect=true&web_token="+this.webToken+"&"+this._collectUtmData();this.log("Organic landing: "+i);var t=this;this.sendRequest(i,(function(i){t._saveClickId(i.id)}),!0)},_generateUserId:function(i){i||(i=this._generateUUID()),window.localStorage.setItem(this.SWAARM_USER_ID_NAME,i)},_saveClickId:function(i){this.log("Saving clkid "+i+"."),window.localStorage.setItem(this.SWAARM_CLICK_ID_NAME,i),this.setCookie(this.SWAARM_CLICK_ID_NAME,i,168)},land:function(){this.validateInit();var i=this.getQueryParams(window.location.search);if(this._generateUserId(i.clkid),null==i.clkid)return this.log("No clkid found."),void this._landOrganic();this._saveClickId(i.clkid)},click:function(i,t){this.validateInit(),this._baseClickImpression("click",i,t)},impression:function(i,t){this.validateInit(),this._baseClickImpression("impression",i,t)},_baseClickImpression:function(i,t,e){this.validateInit();var n=this.getQueryParams(window.location.search);for(var a in t)n[a]=t[a];var r=[];for(var s in n)r.push(s+"="+n[s]);var o=r.join("&");this.sendRequest(this.trackingUrl+i+o,e,!1)},adDetails:function(i,t,e){this.validateInit();var n=window.location.search;null!=i&&null!=t&&(n="offer_id="+i+"&pub_id"+t),this.sendRequest(this.trackingUrl+"ad"+n,e,!0)},replaceMarkedLinks:function(i,t,e){var n=null==i?"a":i,a=this;this.adDetails(null,null,(function(i){var r=i.advertiserTrackingUrl,s=i.clickTrackingUrl+"&no_redirect=true",o=i.impressionTrackingUrl+"&no_redirect=true";null==t?a.sendRequest(o):a.sendRequest(a.trackingUrl+"click?offer_id="+t+"&pub_id="+e+"&no_redirect=true"),document.querySelectorAll(n).forEach((i=>{i.href=r,i.addEventListener("click",(function(){a.sendRequest(s,(function(){document.location.href=r}))}))}))}))},getClickId:function(){var i=window.localStorage.getItem(this.SWAARM_CLICK_ID_NAME);return null==i&&(i=this.getCookie(this.SWAARM_CLICK_ID_NAME)),i},_getUserId:function(){return window.localStorage.getItem(this.SWAARM_USER_ID_NAME)},attribute:function(){this.event(null)},event:function(i){this.validateInit();var t=this.getClickId();null!=t?this.emitEvent(t,i):this.log("No clickid found. Organic attribution.")}},window.Swaarm={initialize:function(i){window._Swaarm.initialize(i.trackingUrl,i.webToken),i.debug&&window._Swaarm.enableDebug()},replaceMarkedLinks:function(i,t,e){window._Swaarm.replaceMarkedLinks(i,t,e)},land:function(){window._Swaarm.land()},click:function(i,t){window._Swaarm.click(i,t)},impression:function(i,t){window._Swaarm.click(i,t)},identifier:function(){return window._Swaarm._getUserId()},attribute:function(){window._Swaarm.attribute()},event:function(i,t){t=null==t?{}:t,window._Swaarm.event({event_id:i,sale_amount:t.saleAmount,sale_amount_currency:t.saleAmountCurrency,original_sale_amount:t.originalSaleAmount,original_sale_amount_currency:t.originalSaleAmountCurrency})}};